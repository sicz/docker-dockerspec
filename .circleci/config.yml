version: 2
jobs:
  build:
    docker:
      - image: docker:17.03
    working_directory: ~/docker-dockerspec
    environment:
      - MAKEFLAGS=--no-print-directory
    steps:
      - run:
          name: Set up Environment
          command: |
            apk update
            apk add --no-progress git make openssh-client
            curl -sSL https://github.com/SICZ/Mk/archive/master.tar.gz | tar -xzf -
            mv Mk-master ~/Mk
      - checkout
      - setup_remote_docker
      - run:
          name: Docker version
          command: |
            docker version
      - run:
          name: Build Docker image
          command: |
            make rebuild
      - run:
          name: Run tests
          command: |
            ls -l
            ls -l spec
            make test
