version: 2
jobs:
  build:
    docker:
      - image: docker:17.03
    working_directory: ~/docker-baseimage-alpine
    environment:
      - MAKEFLAGS=--no-print-directory
    steps:
      - run:
          name: Install packages
          command: |
            apk update
            apk add --no-progress git make openssh-client
      - checkout
      - setup_remote_docker
      - run:
          name: Docker Version
          command: |
            docker version
      - run:
          name: Run tests
          command: |
            curl -sSL https://github.com/SICZ/Mk/archive/master.tar.gz | tar -xzf -
            mv Mk-master ~/Mk
            make rebuild
            make run
            make test
